<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.ac.jejunu.rabbit.mapper.UserMapper">
	<sql id="selectUser">userid, image, name, password, introduce</sql>
	<sql id="selectPost">image, post_num, postid, name, content, regdate</sql>
	
	<select id="followingUserAll" resultType="kr.ac.jejunu.rabbit.model.User" >
		select * from userinfo where userid in (select followerid from follow where userid=#{userid})
	</select>
	
	<select id="followerUserAll" resultType="kr.ac.jejunu.rabbit.model.User" >
		select * from userinfo where userid in (select userid from follow where followerid=#{userid})
	</select>
	
	<select id="findPostAll" resultType="kr.ac.jejunu.rabbit.model.Post" >
		select 
		<include refid="selectPost"/>
		from userinfo INNER JOIN userpost on (userinfo.`userid` = userpost.`postid`) where userinfo.userid = #{userid} ORDER BY regdate DESC;
	</select>
	
	<select id="findById" resultType="kr.ac.jejunu.rabbit.model.User">
		select *
		from userinfo where userid = #{userid}
	</select>
	
	<insert id="UserInsert" parameterType="kr.ac.jejunu.rabbit.model.User">
		insert into userinfo(userid, name, password, introduce, image) values(#{userid}, #{name}, #{password}, #{introduce}, #{image})
	</insert>
	
	<update id="UserUpdate" parameterType="kr.ac.jejunu.rabbit.model.User"> 
		update userinfo set name=#{name}, password=#{password}, introduce=#{introduce}, image=#{image} where userid = #{userid}
	</update>
	
	<delete id="UserDelete" parameterType="kr.ac.jejunu.rabbit.model.User">
		delete from userinfo where userid = #{userid}
	</delete>
	
	<insert id="PostInsert" parameterType="kr.ac.jejunu.rabbit.model.Post" >
		insert into userpost(postid, content) values (#{userid}, #{content})
	</insert>
	
	<delete id="postDelete" parameterType="kr.ac.jejunu.rabbit.model.Post" >
		delete from userpost where postid = #{postid} and post_num = #{post_num}
	</delete>
	
	<select id="Check" parameterType="kr.ac.jejunu.rabbit.model.User" resultType="kr.ac.jejunu.rabbit.model.User" >
		select *
		from userinfo where userid = #{userid} and password = #{password}
	</select>
	
	<insert id="followInsert" parameterType="kr.ac.jejunu.rabbit.model.User"> 
		insert into follow(userid, followerid, state) values (#{userid}, #{followerid}, "following")
	</insert>
	
	<select id="Login" parameterType="kr.ac.jejunu.rabbit.model.User" resultType="kr.ac.jejunu.rabbit.model.User" >
		select *
		from userinfo where userid = #{userid} and password = #{password}
	</select>
	
	<delete id="UserUnfollow" parameterType="kr.ac.jejunu.rabbit.model.Follow">
		delete from follow where userid = #{userid} and followerid = #{followerid}
	</delete>
	
	<select id="getAllUser" resultType="kr.ac.jejunu.rabbit.model.AllUser" >
		select userinfo.image, userinfo.name,  userinfo.userid, userinfo.introduce, follow.followerid
		from userinfo INNER JOIN follow where userinfo.userid = follow.userid and follow.userid = #{userid}  and follow.userid != follow.followerid
	</select>
	
	<select id="getAllFollow" resultType="kr.ac.jejunu.rabbit.model.AllFollow">
		select userinfo.image, userinfo.name, userinfo.introduce, userinfo.userid, follow.followerid
		from follow INNER JOIN userinfo where userinfo.userid = follow.userid and follow.followerid = #{userid}
	</select>
	
	<insert id="userFollow" parameterType="kr.ac.jejunu.rabbit.model.User"> 
		insert into follow(userid, followerid) values (#{userid}, #{followerid})
	</insert>
	
	<select id="getAllUserList" resultType="kr.ac.jejunu.rabbit.model.AllUserList" >
		select * from userinfo where userid != #{userid}
	</select>
	
	<select id="getAllFollowList" resultType="kr.ac.jejunu.rabbit.model.AllFollowList" >
		select userinfo.image, userinfo.name, userinfo.introduce, userinfo.userid, follow.followerid
		from follow INNER JOIN userinfo where userinfo.userid = follow.userid and follow.userid = #{userid}
	</select>
</mapper>